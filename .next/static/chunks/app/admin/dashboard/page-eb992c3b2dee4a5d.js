(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{5170:(e,t,s)=>{Promise.resolve().then(s.bind(s,24163))},24163:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(95155),l=s(12115),n=s(35695),i=s(16152),r=s(20071),d=s(72518),o=s(84423),c=s(66848),m=s(9995);s(11202);let x=["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"],b=Array.from({length:13},(e,t)=>{let s=9+t;return"".concat(s.toString().padStart(2,"0"),":00 - ").concat((s+1).toString().padStart(2,"0"),":00")}),h={el:m.el},u=(0,i.Hz)({format:r.GP,parse:d.qg,startOfWeek:()=>(0,o.k)(new Date,{weekStartsOn:1}),getDay:c.P,locales:h});function p(e){let t=e.getHours(),s=e.getMinutes(),a=t%12;return 0===a&&(a=12),"".concat(a,":").concat(s.toString().padStart(2,"0")," ").concat(t<12?"π.μ.":"μ.μ.")}function f(e){if(!e)return"";if(e.includes("-")){let[t,s]=e.split("-").map(e=>e.trim());return"".concat(f(t)," - ").concat(f(s))}let[t,s]=e.split(":"),a=parseInt(t,10),l=s?parseInt(s,10):0,n=a%12;return 0===n&&(n=12),"".concat(n,":").concat(l.toString().padStart(2,"0")," ").concat(a<12?"π.μ.":"μ.μ.")}function g(){let e=(0,n.useRouter)(),[t,s]=(0,l.useState)([]),[r,d]=(0,l.useState)(!1),[o,c]=(0,l.useState)(""),[m,h]=(0,l.useState)([]),[g,j]=(0,l.useState)({date:"",time:"",service:""}),[y,N]=(0,l.useState)(""),[v,w]=(0,l.useState)([]),[k,S]=(0,l.useState)(1),[C,A]=(0,l.useState)([]),[E,D]=(0,l.useState)(""),[O,_]=(0,l.useState)({}),[q,T]=(0,l.useState)(!1),[z,P]=(0,l.useState)(!1),[F,H]=(0,l.useState)({service:"",date:"",time:"",name:"",telephone:"",email:""}),[I,J]=(0,l.useState)(!1),[V,G]=(0,l.useState)(""),[M,R]=(0,l.useState)(null);async function W(){await fetch("/api/global-timeslots",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({weekday:k,slots:C.map(e=>({time:e,service:""}))})}),N("Τα default slots αποθηκεύτηκαν!")}async function B(){let e=Object.entries(O).map(e=>{let[t,s]=e;return{time:t,service:"",available:s}});await fetch("/api/date-overrides",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:E,overrides:e})}),N("Τα overrides αποθηκεύτηκαν!")}async function L(e){if(!confirm("Θέλετε σίγουρα να ακυρώσετε αυτή την κράτηση;"))return;let a=await fetch("/api/bookings-list?id=".concat(e),{method:"DELETE"}),l=await a.json();N(l.success?"Η κράτηση ακυρώθηκε.":l.error||"Σφάλμα ακύρωσης."),s(t.filter(t=>t._id!==e))}async function U(e){e.preventDefault(),J(!0),G("");try{let e=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)}),t=await e.json();if(e.ok){P(!1),H({service:"",date:"",time:"",name:"",telephone:"",email:""}),N("Η κράτηση δημιουργήθηκε!");let e=await fetch("/api/bookings-list"),t=await e.json();s(Array.isArray(t)?t:[])}else G(t.error||"Σφάλμα κατά τη δημιουργία κράτησης.")}catch(e){G("Σφάλμα κατά τη δημιουργία κράτησης.")}finally{J(!1)}}(0,l.useEffect)(()=>{"true"!==localStorage.getItem("adminSession")&&e.push("/admin/login")},[e]),(0,l.useEffect)(()=>{!async function(){d(!0),c("");try{let e=await fetch("/api/bookings-list"),t=await e.json();Array.isArray(t)?s(t):c(t.error||"Σφάλμα φόρτωσης κρατήσεων.")}catch(e){c("Σφάλμα φόρτωσης κρατήσεων.")}finally{d(!1)}}()},[]),(0,l.useEffect)(()=>{!async function(){let e=await fetch("/api/timeslots"),t=await e.json();Array.isArray(t)&&h(t)}()},[y]),(0,l.useEffect)(()=>{!async function(){let e=await fetch("/api/global-timeslots"),t=await e.json();w(Array.isArray(t)?t:[])}()},[y]),(0,l.useEffect)(()=>{if(!E)return _({});T(!0),fetch("/api/date-overrides?date=".concat(E)).then(e=>e.json()).then(e=>{if(Array.isArray(e)){let t={};e.forEach(e=>{t[e.time]=e.available}),_(t)}else _({})}).finally(()=>T(!1))},[E,y]),(0,l.useEffect)(()=>{A(v.filter(e=>e.weekday===k).map(e=>e.time))},[k,v]);let K=t.map(e=>{let t=e.time;e.time&&e.time.includes("-")&&(t=e.time.split("-")[0].trim());let[s,a]=t.split(":"),l=new Date(e.date);l.setHours(Number(s),Number(a||0));let n=new Date(e.date);if(e.time&&e.time.includes("-")){let[t,s]=e.time.split("-")[1].trim().split(":");n.setHours(Number(t),Number(s||0))}else n.setHours(Number(s)+1,Number(a||0));return{...e,title:e.name,start:l,end:n,allDay:!1}});return(0,a.jsxs)("main",{className:"min-h-screen bg-gray-50 text-black",children:[(0,a.jsxs)("header",{className:"w-full flex justify-between items-center px-8 py-6 border-b border-gray-200 bg-white sticky top-0 z-10",children:[(0,a.jsx)("h1",{className:"text-3xl font-extrabold tracking-tight",children:"Admin Dashboard"}),(0,a.jsx)("button",{onClick:function(){localStorage.removeItem("adminSession"),e.push("/admin/login")},className:"bg-orange-200 hover:bg-orange-300 text-black font-bold px-5 py-2 rounded-lg transition text-base",children:"Αποσύνδεση"})]}),(0,a.jsxs)("section",{className:"w-full max-w-6xl mx-auto py-8 px-4",children:[y&&(0,a.jsx)("div",{className:"mb-4 text-center text-green-700 font-bold text-lg",children:y}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Κρατήσεις"}),(0,a.jsx)("button",{onClick:()=>P(!0),className:"bg-black text-white font-bold px-4 py-2 rounded-lg hover:bg-gray-800 transition",children:"+ Νέα Κράτηση"})]}),z&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md relative",children:[(0,a.jsx)("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-black text-2xl",onClick:()=>P(!1),children:"\xd7"}),(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Νέα Κράτηση"}),(0,a.jsxs)("form",{className:"space-y-4",onSubmit:U,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Υπηρεσία"}),(0,a.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:F.service,onChange:e=>H({...F,service:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Ημερομηνία"}),(0,a.jsx)("input",{type:"date",className:"w-full border rounded px-3 py-2",value:F.date,onChange:e=>H({...F,date:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Ώρα"}),(0,a.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:F.time,onChange:e=>H({...F,time:e.target.value}),required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Όνομα"}),(0,a.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:F.name,onChange:e=>H({...F,name:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Τηλέφωνο"}),(0,a.jsx)("input",{type:"tel",className:"w-full border rounded px-3 py-2",value:F.telephone,onChange:e=>H({...F,telephone:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",className:"w-full border rounded px-3 py-2",value:F.email,onChange:e=>H({...F,email:e.target.value}),required:!0})]}),V&&(0,a.jsx)("div",{className:"text-red-600 text-sm font-bold",children:V}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-black text-white font-bold py-2 rounded-lg hover:bg-gray-800 transition",disabled:I,children:I?"Αποθήκευση...":"Αποθήκευση"})]})]})}),(0,a.jsxs)("div",{className:"mb-8 bg-white rounded-2xl shadow p-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-black",children:"Ημερολόγιο Κρατήσεων"}),(0,a.jsx)(i.Vv,{localizer:u,events:K,startAccessor:"start",endAccessor:"end",style:{height:600},views:["month","week"],defaultView:"month",popup:!0,messages:{month:"Μήνας",week:"Εβδομάδα",today:"Σήμερα",previous:"Προηγούμενος",next:"Επόμενος",showMore:e=>"+".concat(e," ακόμα")},min:new Date(1970,1,1,9,0,0),max:new Date(1970,1,1,21,0,0),timeslots:1,step:60,formats:{timeGutterFormat:p},eventPropGetter:()=>({style:{background:"#FBDAC6",color:"#222",borderRadius:8,border:"none",fontWeight:600}}),onSelectEvent:e=>R(e)}),M&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md relative",children:[(0,a.jsx)("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-black text-2xl",onClick:()=>R(null),children:"\xd7"}),(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Λεπτομέρειες Κράτησης"}),(0,a.jsxs)("div",{className:"space-y-2 text-black text-base",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Όνομα:"})," ",M.name]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Υπηρεσία:"})," ",M.service]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Ημερομηνία:"})," ",M.date]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Ώρα:"})," ",f(M.time)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Τηλέφωνο:"})," ",M.telephone]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Email:"})," ",M.email]})]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,a.jsx)("button",{className:"bg-red-100 text-red-700 font-bold px-4 py-2 rounded hover:bg-red-200 transition",onClick:()=>R({...M,confirm:"cancel"}),children:"Ακύρωση"}),(0,a.jsx)("button",{className:"bg-orange-100 text-orange-700 font-bold px-4 py-2 rounded hover:bg-orange-200 transition",onClick:()=>R({...M,confirm:"edit"}),children:"Επεξεργασία"})]}),"cancel"===M.confirm&&(0,a.jsx)("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/40",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-xs w-full",children:[(0,a.jsx)("div",{className:"mb-4 text-black font-bold",children:"Είστε σίγουροι ότι θέλετε να ακυρώσετε αυτή την κράτηση;"}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-gray-200",onClick:()=>R({...M,confirm:void 0}),children:"Όχι"}),(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-red-500 text-white",onClick:()=>L(M._id),children:"Ναι, ακύρωση"})]})]})}),"edit"===M.confirm&&(0,a.jsx)("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/40",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-xs w-full",children:[(0,a.jsx)("div",{className:"mb-4 text-black font-bold",children:"Επεξεργασία κράτησης"}),(0,a.jsxs)("form",{className:"space-y-3",onSubmit:async e=>{e.preventDefault();let t=new FormData(e.target),a=t.get("date"),l=t.get("time");if(!a||!l)return;let n=await fetch("/api/bookings-list?id=".concat(M._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:a,time:l})}),i=await n.json();if(n.ok&&i.success){R(null),N("Η κράτηση ενημερώθηκε!");let e=await fetch("/api/bookings-list"),t=await e.json();s(Array.isArray(t)?t:[])}else alert(i.error||"Σφάλμα ενημέρωσης κράτησης.")},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Ημερομηνία"}),(0,a.jsx)("input",{type:"date",name:"date",className:"w-full border rounded px-3 py-2",defaultValue:M.date,required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Ώρα"}),(0,a.jsx)("input",{type:"text",name:"time",className:"w-full border rounded px-3 py-2",defaultValue:M.time,required:!0})]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end mt-4",children:[(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded bg-gray-200",onClick:()=>R({...M,confirm:void 0}),children:"Άκυρο"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 rounded bg-orange-500 text-white font-bold",children:"Αποθήκευση"})]})]})]})})]})})]}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-2xl shadow border border-gray-200 bg-white",children:r?(0,a.jsx)("div",{className:"p-8 text-center text-black",children:"Φόρτωση..."}):o?(0,a.jsx)("div",{className:"p-8 text-center text-red-600",children:o}):0===t.length?(0,a.jsx)("div",{className:"p-8 text-center text-black",children:"Δεν υπάρχουν κρατήσεις."}):(0,a.jsxs)("table",{className:"w-full text-base border-separate border-spacing-y-2",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-white z-10",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"py-3 px-2 text-left font-bold",children:"Υπηρεσία"}),(0,a.jsx)("th",{className:"py-3 px-2 text-left font-bold",children:"Ημερομηνία"}),(0,a.jsx)("th",{className:"py-3 px-2 text-left font-bold",children:"Ώρα"}),(0,a.jsx)("th",{className:"py-3 px-2 text-left font-bold",children:"Όνομα"}),(0,a.jsx)("th",{className:"py-3 px-2 text-left font-bold",children:"Τηλέφωνο"}),(0,a.jsx)("th",{className:"py-3 px-2 text-left font-bold",children:"Email"}),(0,a.jsx)("th",{className:"py-3 px-2 text-left font-bold",children:"Ενέργεια"})]})}),(0,a.jsx)("tbody",{children:t.map((e,t)=>(0,a.jsxs)("tr",{className:t%2==0?"bg-gray-50 hover:bg-orange-50 transition":"bg-white hover:bg-orange-50 transition",children:[(0,a.jsx)("td",{className:"py-2 px-2 rounded-l-xl",children:e.service}),(0,a.jsx)("td",{className:"py-2 px-2",children:e.date}),(0,a.jsx)("td",{className:"py-2 px-2",children:f(e.time)}),(0,a.jsx)("td",{className:"py-2 px-2",children:e.name}),(0,a.jsx)("td",{className:"py-2 px-2",children:e.telephone}),(0,a.jsx)("td",{className:"py-2 px-2",children:e.email}),(0,a.jsx)("td",{className:"py-2 px-2 rounded-r-xl",children:(0,a.jsx)("button",{onClick:()=>L(e._id),className:"text-red-600 hover:underline font-bold",children:"Ακύρωση"})})]},e._id))})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-2 text-black",children:"Διαχείριση Διαθεσιμότητας"}),(0,a.jsxs)("div",{className:"bg-gray-100 border border-orange-200 rounded p-4 mb-4",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"mb-2 font-bold text-black",children:"Default slots ανά ημέρα"}),(0,a.jsx)("div",{className:"flex gap-2 mb-4",children:x.map((e,t)=>(0,a.jsx)("button",{className:"px-3 py-1 rounded font-bold border transition ".concat(k===t?"bg-orange-200 border-orange-400 text-black":"bg-white border-gray-300 text-black"),onClick:()=>S(t),children:e},e))}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-4",children:b.map(e=>(0,a.jsx)("button",{className:"px-2 py-2 rounded border font-bold text-sm transition text-black ".concat(C.includes(e)?"bg-orange-200 border-orange-400":"bg-white border-gray-300"),onClick:()=>{A(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},children:e},e))}),(0,a.jsxs)("button",{onClick:W,className:"bg-orange-200 hover:bg-orange-300 text-black font-bold px-4 py-2 rounded transition",children:["Αποθήκευση για ",x[k]]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"mb-2 font-bold text-black",children:"Overrides για συγκεκριμένη ημερομηνία"}),(0,a.jsx)("input",{type:"date",value:E,onChange:e=>D(e.target.value),className:"border rounded px-2 py-1 text-black mb-2"}),E&&(0,a.jsx)(a.Fragment,{children:q?(0,a.jsx)("div",{className:"text-black",children:"Φόρτωση..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-4",children:b.map(e=>(0,a.jsx)("button",{className:"px-2 py-2 rounded border font-bold text-sm transition text-black ".concat(O[e]?"bg-orange-200 border-orange-400":"bg-white border-gray-300"),onClick:()=>{_(t=>({...t,[e]:!t[e]}))},children:e},e))}),(0,a.jsxs)("button",{onClick:B,className:"bg-orange-200 hover:bg-orange-300 text-black font-bold px-4 py-2 rounded transition",children:["Αποθήκευση για ",E]})]})})]})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[859,385,674,441,684,358],()=>t(5170)),_N_E=e.O()}]);